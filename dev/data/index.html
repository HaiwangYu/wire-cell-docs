<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Persistency - Wire Cell Documentation</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Persistency";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Wire Cell Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Overview</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Installation</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../install/install/">Install Wire Cell</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../install/external/">Install Externals</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Developer</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../overview/">Overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dev/">Building</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../iface/">Interfaces</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Persistency</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#schema">Schema</a></li>
                
                    <li><a class="toctree-l4" href="#generalities">Generalities</a></li>
                
                    <li><a class="toctree-l4" href="#geometry">Geometry</a></li>
                
                    <li><a class="toctree-l4" href="#channel">Channel</a></li>
                
                    <li><a class="toctree-l4" href="#cell">Cell</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../test/">Testing</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Algorithms</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../alg/cell/">Making Cells</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../alg/blob/">Blob Reconstruction</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Visualization</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../viz/webgl/">WebGL</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Meta</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../meta/meta/">About</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Wire Cell Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Developer &raquo;</li>
        
      
    
    <li>Persistency</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/WireCell/wire-cell-docs/" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Wire Cell has a simple ROOT I/O persistency module.  </p>
<h1 id="schema">Schema</h1>
<p>The data is saved to several ROOT TFiles is shown in the following
figure.  Refer to the <a href="#terms">terms</a> section for a nomenclature.</p>
<p><img alt="rootdata" src="../../img/rootdata.svg" /></p>
<p>([<a href="../../img/rootdata.png">PNG</a>], [<a href="../../img/rootdata.pdf">PDF</a>], [<a href="../../img/rootdata.dot">DOT</a>] and [<a href="../../img/rootdata.svg">SVG</a>])</p>
<h2 id="generalities">Generalities</h2>
<p>To store the data into a ROOT file we must take care of ownership and
references explicitly.  In general this is handled by representing
ownership as an array of objects and references as an index into this
array.</p>
<p>There are three trees: Geometry, Channel and Cell.</p>
<h2 id="geometry">Geometry</h2>
<p>The geometry is saved into a tree with a single entry.  There are
three owning arrays, <code>WireStore</code>, <code>PointStore</code> and <code>TilingStore</code>
owning:</p>
<ul>
<li>
<p><code>Wire</code> with associated channel ID number (referred to in the
Channel data tree) and two end points</p>
</li>
<li>
<p><code>Point</code> all 3d Points referred to by other objects.</p>
</li>
<li>
<p><code>Cell</code> associates a Wire via it's index (<code>wid</code>) with a center
  point and an (ordered) array of points that make up the corners of
  the cell.</p>
</li>
</ul>
<h2 id="channel">Channel</h2>
<p>Information about charge read out from all channels in a frame.  One
entry in this branch spans an entire readout frame.</p>
<ul>
<li>
<p><code>ChannelStore</code> holds all channel data for the frame</p>
</li>
<li>
<p><code>ChannelSlice</code> associates a time bin <code>tbin</code> that counts relative
to the start of the frame with a collection of read out channel
charges.  A negative charge is undefined.</p>
</li>
<li>
<p><code>ChannelCharge</code> associates a channel ID with a charge.</p>
</li>
</ul>
<h2 id="cell">Cell</h2>
<p>The Cell branch holds associations between charge and cells and groups
of cells.  This branch may hold MC truth value or reconstruction.</p>
<ul>
<li>
<p><code>CellCharge</code> associates a cell ID, which is an index into the
  <code>TilingStore</code> with a charge.  A negative charge is undefined.</p>
</li>
<li>
<p><code>Blob</code> owns an array of <code>CellCharge</code>.  The <code>technique</code> is a user
  defined string to label the origin of the blob (eg, "simtruth" or
  maybe "2dtoyreco", etc).  The <code>tbin</code> counts the time bin from the
  beginning of the frame, the <code>qtot</code> is some measure of the charge for
  the blob as a whole (and may not necessarily be the sum of the
  charge on the individual cells).  The <code>quality</code>is a
  <code>technique</code>-specific measure of quality and finally the array of
  cell charge.</p>
</li>
<li>
<p><code>BlobCluster</code> is a (non-owning) association of blobs.  This may be
  used to collect blobs together within one time slice or may be used
  to collect them together across multiple time slices such as to form
  the blobs contributing to a track or a shower.  Blobs are referenced
  by their index into the frame's <code>BlobStore</code>.  All available
  <code>BlobClusters</code> are stored in the <code>ClusterStore</code></p>
</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../test/" class="btn btn-neutral float-right" title="Testing"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../iface/" class="btn btn-neutral" title="Interfaces"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../iface/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../test/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
